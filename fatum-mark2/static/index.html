<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FATUM MARK 2 // QUANTUM FENG SHUI</title>
    <link rel="stylesheet" href="editor.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
</head>
<body>
    <div class="scanlines"></div>
    <div class="glow-overlay"></div>

    <!-- Tooltip Container -->
    <div id="tooltip-box" class="tooltip-box" style="display:none;"></div>

    <div id="app">
        <header>
            <h1>FATUM MARK 2 <span class="blink">_ONLINE</span></h1>
            <nav id="main-nav">
                <div class="nav-group">
                    <span class="nav-label">IDENTITY</span>
                    <button onclick="showTab('profiles')" class="nav-btn" data-tooltip="Manage User Profiles and Birth Data">Profiles</button>
                </div>

                <div class="nav-group">
                    <span class="nav-label">CORE TOOLS</span>
                    <button onclick="showTab('fengshui')" class="nav-btn active" data-tooltip="Flying Stars, BaZi, and Floorplan Analysis">Feng Shui</button>
                    <button onclick="showTab('zeri')" class="nav-btn" data-tooltip="Quantum Date Selection">Date Selection</button>
                    <button onclick="showTab('divination')" class="nav-btn" data-tooltip="I Ching Divination with Quantum Coins">Divination</button>
                </div>

                <div class="nav-group">
                    <span class="nav-label">ADVANCED</span>
                    <button onclick="showTab('ziwei')" class="nav-btn" data-tooltip="Purple Star Astrology">Zi Wei Dou Shu</button>
                    <button onclick="showTab('daliuren')" class="nav-btn" data-tooltip="The Three Styles: Da Liu Ren">Da Liu Ren</button>
                </div>

                <div class="nav-group">
                    <span class="nav-label">QUANTUM</span>
                    <button onclick="showTab('entropy')" class="nav-btn" data-tooltip="Manage Entropy Batches and Harvesting">Flux</button>
                    <button onclick="showTab('entanglement')" class="nav-btn" data-tooltip="Synastry and Relationship Resonance">Entanglement</button>
                    <button onclick="showTab('manyworlds')" class="nav-btn" data-tooltip="Simulate Alternate Timelines">Many Worlds</button>
                </div>

                <div class="nav-group">
                    <span class="nav-label">SYSTEM</span>
                    <button onclick="showTab('history')" class="nav-btn" data-tooltip="View Past Analysis Records">History</button>
                </div>
            </nav>
        </header>

        <main>
            <!-- PROFILES TAB -->
            <section id="tab-profiles" class="tab-content" style="display:none;">
                <h2>USER PROFILES</h2>
                <div class="panel">
                    <div class="form-group">
                        <label>Name:</label> <input type="text" id="p-name" data-tooltip="Enter the name of the entity">
                    </div>
                    <div class="form-row">
                        <div><label>Year:</label> <input type="number" id="p-year" value="1990"></div>
                        <div><label>Month:</label> <input type="number" id="p-month" value="1"></div>
                        <div><label>Day:</label> <input type="number" id="p-day" value="1"></div>
                        <div><label>Hour:</label> <input type="number" id="p-hour" value="12"></div>
                    </div>
                    <div class="form-group">
                        <label>Gender:</label>
                        <select id="p-gender">
                            <option value="M">Male</option>
                            <option value="F">Female</option>
                        </select>
                    </div>
                    <button class="cyber-btn" onclick="createProfile()">REGISTER ENTITY</button>
                </div>
                <div id="profile-list" class="data-grid">
                    <!-- Loaded dynamically -->
                </div>
            </section>

            <!-- QUANTUM FLUX TAB -->
            <section id="tab-entropy" class="tab-content" style="display:none;">
                <h2>QUANTUM ENTROPY HARVESTING</h2>
                <div class="panel">
                    <p>Harvest true random entropy from the CURBy beacon and cache it for high-fidelity simulations.</p>
                    <div class="form-group">
                         <label>New Batch Name:</label>
                         <input type="text" id="entropy-batch-name" placeholder="E.g. Full Moon Meditation" data-tooltip="Name this entropy collection for later reference">
                         <button class="cyber-btn small" onclick="createEntropyBatch()">CREATE BATCH</button>
                    </div>
                    <hr>
                    <div id="active-harvest-panel" style="display:none;">
                         <h3 style="color:var(--accent);">HARVEST IN PROGRESS</h3>
                         <p>Batch ID: <span id="harvest-batch-id">-</span></p>
                         <button class="cyber-btn warning" onclick="stopHarvest()">STOP HARVEST</button>
                    </div>
                </div>
                <button class="cyber-btn secondary" onclick="loadEntropyBatches()">REFRESH LIST</button>
                <div id="entropy-batch-list" class="data-grid">
                    <!-- Batches -->
                </div>
            </section>

            <!-- FENG SHUI TAB -->
            <section id="tab-fengshui" class="tab-content">
                <div class="sidebar">

                    <details open>
                        <summary>MAIN PARAMETERS</summary>
                        <div class="details-content">
                            <div class="form-group">
                                <label>Active Profile:</label>
                                <select id="fs-profile-select" onchange="loadProfileIntoForm()" data-tooltip="Select a profile to include BaZi analysis">
                                    <option value="">-- Manual Input --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Construction Year:</label>
                                <input type="number" id="fs-year" value="2004" data-tooltip="Year the building was completed (determines Period)">
                            </div>
                            <div class="form-group">
                                <label>Facing (Deg):</label>
                                <input type="number" id="fs-facing" value="180" data-tooltip="Compass degree the building faces (0-360)">
                            </div>
                            <div class="form-group">
                                <label>Intention:</label>
                                <input type="text" id="fs-intention" placeholder="Wealth, Health..." data-tooltip="Focus of the analysis">
                            </div>
                        </div>
                    </details>

                    <details>
                        <summary>QUANTUM CONFIGURATION</summary>
                        <div class="details-content">
                            <div class="form-group">
                                <label>Entropy Source:</label>
                                <select id="fs-entropy-source" data-tooltip="Choose between Live Stream or Pre-Recorded Entropy">
                                    <option value="">Live Quantum Stream (Default)</option>
                                    <!-- Populated dynamically -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-container">
                                    <input type="checkbox" id="fs-quantum" data-tooltip="Enable probabilistic chart variations">
                                    <span class="checkmark"></span>
                                    Quantum Mode
                                </label>
                            </div>
                        </div>
                    </details>

                    <button class="cyber-btn" onclick="runFengShui()">INITIATE SEQUENCE</button>
                    <button class="cyber-btn secondary" onclick="saveReport('fengshui')">ARCHIVE RESULT</button>
                    <button class="cyber-btn secondary" onclick="downloadPdf()">DOWNLOAD PDF</button>

                    <details>
                        <summary>VIRTUAL CURES</summary>
                        <div class="details-content">
                            <div id="virtual-cures-panel">
                                <p class="small-text">Drag elements onto the chart to simulate cures.</p>
                                <div class="cure-palette">
                                    <div class="cure-item" draggable="true" ondragstart="drag(event)" data-type="Metal" style="border-color:var(--metal); color:var(--metal)">Metal</div>
                                    <div class="cure-item" draggable="true" ondragstart="drag(event)" data-type="Water" style="border-color:var(--water); color:var(--water)">Water</div>
                                    <div class="cure-item" draggable="true" ondragstart="drag(event)" data-type="Wood" style="border-color:var(--wood); color:var(--wood)">Wood</div>
                                    <div class="cure-item" draggable="true" ondragstart="drag(event)" data-type="Fire" style="border-color:var(--fire); color:var(--fire)">Fire</div>
                                    <div class="cure-item" draggable="true" ondragstart="drag(event)" data-type="Earth" style="border-color:var(--earth); color:var(--earth)">Earth</div>
                                </div>
                            </div>
                        </div>
                    </details>

                    <details>
                        <summary>FLOORPLAN & GRID</summary>
                        <div class="details-content">
                            <div class="form-group">
                                <label>Upload Image:</label>
                                <input type="file" id="fs-floorplan-upload" accept="image/*" data-tooltip="Upload a floorplan image to overlay">
                            </div>
                            <div class="form-group">
                                <label>Grid X:</label>
                                <input type="range" id="fs-grid-x" min="-300" max="300" value="0" oninput="updateGridTransform()">
                            </div>
                            <div class="form-group">
                                <label>Grid Y:</label>
                                <input type="range" id="fs-grid-y" min="-300" max="300" value="0" oninput="updateGridTransform()">
                            </div>
                            <div class="form-group">
                                <label>Grid Scale:</label>
                                <input type="range" id="fs-grid-scale" min="0.1" max="2.0" step="0.1" value="1.0" oninput="updateGridTransform()">
                            </div>
                            <div class="form-group">
                                <label>Grid Opacity:</label>
                                <input type="range" id="fs-grid-opacity" min="0.1" max="1.0" step="0.1" value="0.8" oninput="updateGridTransform()">
                            </div>
                        </div>
                    </details>
                </div>

                <div class="viewport">
                    <div id="fs-svg-container" class="svg-container"></div>
                    <div id="bazi-svg-container" class="svg-container"></div>
                    <div id="fs-output" class="console-output">
                        > Awaiting Input...
                    </div>
                </div>
            </section>

            <!-- DATE SELECTION TAB -->
            <section id="tab-zeri" class="tab-content" style="display:none;">
                <h2>QUANTUM DATE SELECTION</h2>
                <div class="panel">
                    <div class="form-row">
                        <div><label>Start Date:</label> <input type="date" id="zr-start"></div>
                        <div><label>End Date:</label> <input type="date" id="zr-end"></div>
                    </div>
                    <div class="form-group">
                        <label>Intention / Activities:</label>
                        <input type="text" id="zr-intention" placeholder="Wedding, Travel (Comma separated)">
                    </div>
                    <div class="form-group">
                        <label class="checkbox-container">
                            <input type="checkbox" id="zr-personal" checked>
                            <span class="checkmark"></span>
                            Personalized Mode (Uses Active Profile)
                        </label>
                    </div>
                    <button class="cyber-btn" onclick="runZeRi()">SCAN TIMELINE</button>
                </div>
                <div id="zr-output" class="data-grid">
                    <!-- Results -->
                </div>
            </section>

            <!-- ZI WEI DOU SHU TAB -->
            <section id="tab-ziwei" class="tab-content" style="display:none;">
                <h2>ZI WEI DOU SHU (PURPLE STAR)</h2>
                <div class="panel">
                    <p>Requires an Active Profile selected in the Feng Shui tab.</p>
                    <button class="cyber-btn" onclick="runZiWei()">CALCULATE CHART</button>
                </div>
                <div id="zw-chart-container" class="chart-container">
                    <!-- Chart Grid -->
                </div>
            </section>

            <!-- DA LIU REN TAB -->
            <section id="tab-daliuren" class="tab-content" style="display:none;">
                <h2>DA LIU REN (SIX REN)</h2>
                <div class="panel">
                    <p>Requires an Active Profile (for Day/Hour calc) or Manual Input.</p>
                    <div class="form-row">
                        <div><label>Day Stem (0-9):</label> <input type="number" id="dlr-stem" value="0"></div>
                        <div><label>Day Branch (0-11):</label> <input type="number" id="dlr-branch" value="0"></div>
                        <div><label>Hour Branch (0-11):</label> <input type="number" id="dlr-hour" value="0"></div>
                        <div><label>Solar Term (0-23):</label> <input type="number" id="dlr-term" value="0"></div>
                    </div>
                    <button class="cyber-btn" onclick="runDaLiuRen()">CALCULATE PLATE</button>
                </div>
                <div id="dlr-output" class="console-output"></div>
            </section>

            <!-- ENTANGLEMENT TAB -->
            <section id="tab-entanglement" class="tab-content" style="display:none;">
                <h2>QUANTUM ENTANGLEMENT (SYNASTRY)</h2>
                <div class="panel">
                    <div class="form-group">
                        <label>Profile A (The Subject):</label>
                        <select id="ent-profile1"></select>
                    </div>
                    <div class="form-group">
                        <label>Profile B (The Object):</label>
                        <select id="ent-profile2"></select>
                    </div>
                    <div class="form-group">
                        <label>Entanglement Mode:</label>
                        <select id="ent-mode">
                            <option value="SeedHash">Seed Hash (Deterministic Resonance)</option>
                            <option value="EntropyStream">Entropy Stream (Quantum Correlation)</option>
                        </select>
                    </div>
                    <button class="cyber-btn" onclick="runEntanglement()">ANALYZE RESONANCE</button>
                </div>
                <div id="ent-output" class="console-output large-text">
                    <!-- Output -->
                </div>
            </section>

            <!-- MANY WORLDS TAB -->
            <section id="tab-manyworlds" class="tab-content" style="display:none;">
                <h2>MANY WORLDS SIMULATION</h2>
                <div class="panel">
                    <p>Branching probability engine simulating alternate timelines of elemental flow.</p>
                    <div class="form-group">
                        <label>Subject Profile:</label>
                        <select id="mw-profile"></select>
                    </div>
                    <div class="form-row">
                         <div><label>Duration (Years):</label> <input type="number" id="mw-duration" value="10"></div>
                         <div><label>Timelines:</label> <input type="number" id="mw-worlds" value="50"></div>
                    </div>
                    <button class="cyber-btn" onclick="runManyWorldsSimulation()">SIMULATE TIMELINES</button>
                    <div id="mw-status" style="margin-top:10px; color:#0ff;"></div>
                </div>
                <div id="mw-chart-container" class="chart-container" style="height: 500px; border: 1px solid #333; margin-top:20px;">
                    <!-- SVG Chart -->
                </div>
            </section>

            <!-- DIVINATION TAB -->
            <section id="tab-divination" class="tab-content" style="display:none;">
                <h2>QUANTUM I CHING</h2>
                <div class="divination-container">
                    <div class="hex-display">
                        <div id="hex-svg-container" class="svg-container"></div>
                    </div>
                    <div class="controls">
                        <p>Accessing CURBy Quantum Entropy Source...</p>
                        <button class="cyber-btn" onclick="castHexagram()">CAST HEXAGRAM</button>
                        <button class="cyber-btn secondary" onclick="saveReport('divination')">ARCHIVE RESULT</button>
                    </div>
                </div>
                <div id="divination-text" class="console-output large-text">
                    <!-- Text goes here -->
                </div>
            </section>

            <!-- HISTORY TAB -->
            <section id="tab-history" class="tab-content" style="display:none;">
                <h2>ARCHIVES</h2>
                <button class="cyber-btn small" onclick="loadHistory()">REFRESH</button>
                <div id="history-list" class="data-grid">
                    <!-- Loaded dynamically -->
                </div>
            </section>
        </main>
    </div>

    <script src="visual_feng_shui.js"></script>
    <script src="visual_zi_wei.js"></script>
    <script src="visual_da_liu_ren.js"></script>
    <script src="visual_many_worlds.js"></script>
</body>
</html>
